data_trend_iden <- data_trend_iden %>%
filter(is.na(ma100_chg_30)) %>%
mutate(trend = ifelse(n_increase >= 6, "up",
ifelse(n_decrease >= 6, "down", "undefined")
)
)
data_trend_iden <- data_tut_1
for (i in c(1,2,3,5,10,15,20,30)) {
col_name <- paste0("ma100_chg_", i)
data_trend_iden <- data_trend_iden %>%
mutate(!!col_name := (ma100 / lag(ma100, i) - 1) * 100)
}
# create a column of 0
data_trend_iden <- data_trend_iden %>%
mutate(n_increase = 0,
n_decrease = 0)
for (i in c(130:nrow(data_trend_iden))) {
count_up <- 0
count_down <- 0
for (j in c(1,2,3,5,10,15,20,30)) {
col_name <- paste0("ma100_chg_", j)
if (data_trend_iden[i, col_name] > 0){
count_up <- count_up + 1
}
if (data_trend_iden[i, col_name] < 0){
count_down <- count_down + 1
}
data_trend_iden[i, "n_increase"] <- count_up
data_trend_iden[i, "n_decrease"] <- count_down
}
}
data_trend_iden <- data_trend_iden %>%
filter(!is.na(ma100_chg_30)) %>%
mutate(trend = ifelse(n_increase >= 6, "up",
ifelse(n_decrease >= 6, "down", "undefined")
)
)
data_trend_iden <- data_tut_1
for (i in c(1,2,3,5,10,15,20,30)) {
col_name <- paste0("ma100_chg_", i)
data_trend_iden <- data_trend_iden %>%
mutate(!!col_name := (ma100 / lag(ma100, i) - 1) * 100)
}
# create a column of 0
data_trend_iden <- data_trend_iden %>%
mutate(n_increase = 0,
n_decrease = 0)
for (i in c(130:nrow(data_trend_iden))) {
count_up <- 0
count_down <- 0
for (j in c(1,2,3,5,10,15,20,30)) {
col_name <- paste0("ma100_chg_", j)
if (data_trend_iden[i, col_name] > 0){
count_up <- count_up + 1
}
if (data_trend_iden[i, col_name] < 0){
count_down <- count_down + 1
}
data_trend_iden[i, "n_increase"] <- count_up
data_trend_iden[i, "n_decrease"] <- count_down
}
}
data_trend_iden <- data_trend_iden %>%
# filter(!is.na(ma100_chg_30)) %>%
mutate(trend = ifelse(n_increase >= 6, "up",
ifelse(n_decrease >= 6, "down", "undefined")
)
)
ggplotly(
data_tut_1 %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1, color = 'ask')) +
geom_line(aes(y = bid_price_1, color = 'bid')) +
geom_line(aes(y = ma20, color = trend)) +
geom_line(aes(y = ma100, color = 'ma100'))
)
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1, color = 'ask')) +
geom_line(aes(y = bid_price_1, color = 'bid')) +
geom_line(aes(y = ma20, color = trend)) +
geom_line(aes(y = ma100, color = 'ma100'))
)
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = 'red') +
geom_line(aes(y = bid_price_1), color = 'green') +
geom_line(aes(y = ma20, color = trend)) +
geom_line(aes(y = ma100), color = 'grey')
)
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = 'red') +
geom_line(aes(y = bid_price_1), color = 'green') +
geom_line(aes(y = ma20, color = as.factor(trend))) +
geom_line(aes(y = ma100), color = 'grey')
)
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = 'red') +
geom_line(aes(y = bid_price_1), color = 'green') +
geom_line(aes(y = ma20, fill = as.factor(trend))) +
geom_line(aes(y = ma100), color = 'grey')
)
ggplot(data_trend_iden, aes(x = timestamp)) +
geom_line(aes(y = ma20, color = as.factor(trend)))
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = 'red') +
geom_line(aes(y = bid_price_1), color = 'green') +
geom_line(aes(y = ma20, color = trend, group = 1)) +
geom_line(aes(y = ma100), color = 'grey')
)
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = '#800000') +
geom_line(aes(y = bid_price_1), color = '#008000') +
geom_line(aes(y = ma20, color = ifelse(trend = 'up', '#000080',
ifelse(trend = 'down', '#800080',
'#008080')
)
)
) +
geom_line(aes(y = ma100), color = 'grey')
)
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = '#800000') +
geom_line(aes(y = bid_price_1), color = '#008000') +
geom_line(aes(y = ma20, color = ifelse(trend == 'up', '#000080',
ifelse(trend == 'down', '#800080',
'#008080')
)
)
) +
geom_line(aes(y = ma100), color = 'grey')
)
# ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = '#800000') +
geom_line(aes(y = bid_price_1), color = '#008000') +
geom_line(aes(y = ma20, color = ifelse(trend == 'up', '#000080',
ifelse(trend == 'down', '#800080',
'#008080')
)
)
) +
geom_line(aes(y = ma100), color = 'grey')
# ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = '#800000') +
geom_line(aes(y = bid_price_1), color = '#008000') +
geom_line(aes(y = ma20, color = ifelse(trend == 'up', '#000080',
ifelse(trend == 'down', '#800080',
'#008080')
)
)
) +
geom_line(aes(y = ma100), color = 'grey')
# ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1), color = '#800000') +
geom_line(aes(y = bid_price_1), color = '#008000') +
geom_line(aes(y = ma100, color = ifelse(trend == 'up', '#000080',
ifelse(trend == 'down', '#800080',
'#008080')
)
)
) +
geom_line(aes(y = ma20), color = 'grey')
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100, color = ifelse(trend == 'up', '#000080',
ifelse(trend == 'down', '#800080',
'#008080')
)
)
)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100, color = ifelse(trend == 'up', '#000080',
ifelse(trend == 'down', '#800080',
'#008080')
)
)
)+
scale_color_discrete(legend.position = 'null')
View(data_trend_iden)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100, color = ifelse(trend == 'up', '#000080',
ifelse(trend == 'down', '#800080',
'#008080')
)
)
)
)
geom_point(aes(y=trend))
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100)) +
geom_point(aes(y=trend))
)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100)) +
geom_point(aes(y=trend))
)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100)) +
geom_point(aes(y=as.factor(trend)))
)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100)) +
geom_point(aes(y=as.factor(trend)))
)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100))
)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = factor(ma100), color = trend)) +
geom_point(aes(y = factor(ma100), color = trend))
)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100, color = trend)) +
geom_point(aes(y = ma100, color = trend))
)
# )
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100, color = trend)) +
geom_point(aes(y = ma100, color = trend))
)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ma100, color = trend))
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1))
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1))
)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1))
ggplotly(
data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1)) +
guides(color = FALSE)
)
plot1 <-data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1)) +
guides(color = FALSE)
ggplotly(plot1)
plot1 <-data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1)) +
guides(color = FALSE)
ggplotly(plot1)
p <- data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1)) +
guides(color = FALSE)
ggplotly(p)
p <- data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1)) +
guides(color = FALSE)
p <- ggplotly(p)
# Manually add the color scale
p <- p %>%
add_trace(
type = 'scatter',
mode = 'markers',
x = 1,
y = 1,
color = I(c('#000080', '#800080', '#008080')),
marker = list(size = 0, showscale = TRUE),
showlegend = FALSE,
hoverinfo = 'none'
) %>%
layout(
xaxis = list(title = 'Timestamp'),
yaxis = list(title = 'MA100'),
margin = list(l = 40, r = 10, t = 40, b = 40)
)
p <- data_trend_iden %>%
filter(product == 'BANANAS') %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1)) +
guides(color = FALSE)
p <- ggplotly(p)
# Manually add the color scale
p <- p %>%
add_trace(
type = 'scatter',
mode = 'markers',
x = 1,
y = 1,
color = I(c('#000080', '#800080', '#008080')),
marker = list(size = 0, showscale = TRUE),
showlegend = FALSE,
hoverinfo = 'none'
) %>%
layout(
xaxis = list(title = 'Timestamp'),
yaxis = list(title = 'MA100'),
margin = list(l = 40, r = 10, t = 40, b = 40)
)
# Manually add the color scale
p <- p %>%
add_trace(
type = 'scatter',
mode = 'markers',
x = 1,
y = 1,
color = I(c('#000080', '#800080', '#008080')),
marker = list(size = 0, showscale = TRUE),
showlegend = FALSE,
hoverinfo = 'none'
) %>%
layout(
xaxis = list(title = 'Timestamp'),
yaxis = list(title = 'MA100'),
margin = list(l = 40, r = 10, t = 40, b = 40)
)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
slice(100: 500)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
slice(100: 500) %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1))
data_trend_iden %>%
filter(product == 'BANANAS') %>%
slice(100: 500) %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1), size = 2)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
slice(100: 500) %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1), size = 1)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
slice(130: 500) %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1), size = 1)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
slice(300: 1000) %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1), size = 1)
data_trend_iden %>%
filter(product == 'BANANAS') %>%
slice(500: 1200) %>%
ggplot(aes(x = timestamp, y = ma100, color = trend)) +
geom_line(aes(group = 1), size = 1)
ggplotly(
data_tut_1 %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1, color = 'ask')) +
geom_line(aes(y = bid_price_1, color = 'bid')) +
geom_line(aes(y = ma20)) +
geom_line(aes(y = ma100, color = 'ma100'))
)
ggplotly(
data_tut_1 %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1, color = 'ask')) +
geom_line(aes(y = bid_price_1, color = 'bid')) +
geom_line(aes(y = ma20)) +
# geom_line(aes(y = ma100, color = 'ma100')) +
geom_line(aes(y = mid_price, color = 'mid'))
)
ggplotly(
data_tut_1 %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1, color = 'ask')) +
geom_line(aes(y = bid_price_1, color = 'bid')) +
geom_line(aes(y = ma20, color = 'ma20')) +
# geom_line(aes(y = ma100, color = 'ma100')) +
geom_line(aes(y = mid_price))
)
oduct == 'BANANAS') %>%
ggplotly(
data_tut_1 %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1, color = 'ask')) +
geom_line(aes(y = bid_price_1, color = 'bid')) +
geom_line(aes(y = ma20, color = 'ma20')) +
# geom_line(aes(y = ma100, color = 'ma100')) +
# geom_line(aes(y = mid_price))
)
ggplotly(
data_tut_1 %>%
filter(product == 'BANANAS') %>%
mutate(ma20 = rollmean(mid_price, k = 20, align = "right", fill = NA),
ma100 = rollmean(mid_price, k = 100, align = "right", fill = NA)) %>%
ggplot(aes(x = timestamp)) +
geom_line(aes(y = ask_price_1, color = 'ask')) +
geom_line(aes(y = bid_price_1, color = 'bid')) +
geom_line(aes(y = ma20, color = 'ma20'))
# geom_line(aes(y = ma100, color = 'ma100')) +
# geom_line(aes(y = mid_price))
)
